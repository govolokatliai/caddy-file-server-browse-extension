{{- define "icon"}}
	{{- if .IsDir}}
		{{- if .IsSymlink}}folder-symlink
		{{- else}}folder
		{{- end}}
	{{- else if or (eq .Name "LICENSE") (eq .Name "README")}}license
	{{- else if .HasExt ".jpg" ".jpeg" ".png" ".gif" ".webp" ".tiff" ".bmp" ".heif" ".heic" ".svg"}}image
	{{- else if .HasExt ".mp4" ".mov" ".mpeg" ".mpg" ".avi" ".ogg" ".webm" ".mkv" ".vob" ".gifv" ".3gp"}}video
	{{- else if .HasExt ".mp3" ".m4a" ".aac" ".ogg" ".flac" ".wav" ".wma" ".midi" ".cda"}}audio
	{{- else if .HasExt ".pdf"}}pdf
	{{- else if .HasExt ".csv" ".tsv"}}csv
	{{- else if .HasExt ".txt" ".doc" ".docx" ".odt" ".fodt" ".rtf"}}doc
	{{- else if .HasExt ".xls" ".xlsx" ".ods" ".fods"}}sheet
	{{- else if .HasExt ".ppt" ".pptx" ".odp" ".fodp"}}ppt
	{{- else if .HasExt ".zip" ".gz" ".xz" ".tar" ".7z" ".rar" ".xz" ".zst"}}archive
	{{- else if .HasExt ".deb" ".dpkg"}}deb
	{{- else if .HasExt ".rpm" ".exe" ".flatpak" ".appimage" ".jar" ".msi" ".apk"}}dist
	{{- else if .HasExt ".ps1"}}ps1
	{{- else if .HasExt ".py" ".pyc" ".pyo"}}py
	{{- else if .HasExt ".bash" ".sh" ".com" ".bat" ".dll" ".so"}}sh
	{{- else if .HasExt ".dmg"}}dmg
	{{- else if .HasExt ".iso" ".img"}}iso
	{{- else if .HasExt ".md" ".mdown" ".markdown"}}md
	{{- else if .HasExt ".ttf" ".otf" ".woff" ".woff2" ".eof"}}font
	{{- else if .HasExt ".go"}}go
	{{- else if .HasExt ".html" ".htm"}}html
	{{- else if .HasExt ".js"}}js
	{{- else if .HasExt ".css"}}css
	{{- else if .HasExt ".json" ".json5" ".jsonc"}}json
	{{- else if .HasExt ".ts"}}ts
	{{- else if .HasExt ".sql"}}sql
	{{- else if .HasExt ".db" ".sqlite" ".bak" ".mdb"}}db
	{{- else if .HasExt ".eml" ".email" ".mailbox" ".mbox" ".msg"}}email
	{{- else if .HasExt ".crt" ".pem" ".x509" ".cer" ".ca-bundle"}}cert
	{{- else if .HasExt ".key" ".keystore" ".jks" ".p12" ".pfx" ".pub"}}keystore
	{{- else}}
		{{- if .IsSymlink}}symlink
		{{- else}}generic
		{{- end}}
	{{- end}}
{{- end}}
<!DOCTYPE html>
<html>
	<head>
		<title>{{html .Name}}</title>
		<meta charset="utf-8">
		<meta name="color-scheme" content="light dark">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" 
			href="https://cdn.jsdelivr.net/gh/glowinthedark/caddy-file-server-browse-extension/css/atelier-estuary-light.min.css">
		<!-- SEE all available styles: https://unpkg.com/browse/@highlightjs/cdn-assets@11.11.1/styles/ -->
		<link rel="stylesheet" 
			href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/panda-syntax-light.css"
			media="screen and (prefers-color-scheme: light)">
		<link rel="stylesheet" 
			href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/panda-syntax-dark.min.css"
			media="screen and (prefers-color-scheme: dark)">
		<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
* { padding: 0; margin: 0; box-sizing: border-box; }

body {
	font-family: Inter, system-ui, sans-serif;
	font-size: 16px;
	text-rendering: optimizespeed;
	background-color: #f3f6f7;
	min-height: 100vh;
}

img,
svg {
	vertical-align: middle;
	z-index: 1;
}

img {
	max-width: 100%;
	max-height: 100%;
	border-radius: 5px;
}

td img {
	max-width: 1.5em;
	max-height: 2em;
	object-fit: cover;
}

body,
a,
svg,
.layout.current,
.layout.current svg,
.go-up {
	color: #333;
	text-decoration: none;
}

.wrapper {
	max-width: 1200px;
	margin-left: auto;
	margin-right: auto;
}

header,
.meta {
	padding-left: 5%;
	padding-right: 5%;
}

td a {
	color: #006ed3;
	text-decoration: none;
}

div.entry a.nowPlaying,
tr.file td>a.nowPlaying {
	color: #ee9a00 !important;
}

tr.file td>a.nowPlaying::before {
	content: 'â€£';
}

div.entry a.nowPlaying::after {
	content: 'ðŸ”Š';
}

td a:hover {
	color: #0095e4;
}

td a:visited {
	color: #800080;
}

td a:visited:hover {
	color: #b900b9;
}

th:first-child,
td:first-child {
	width: 5%;
}

th:last-child,
td:last-child {
	width: 5%;
}

.size,
.timestamp {
	font-size: 14px;
}

.grid .size {
	font-size: 12px;
	margin-top: .5em;
	color: #496a84;
}

header {
	padding-top: 15px;
	padding-bottom: 15px;
	box-shadow: 0px 0px 20px 0px rgb(0 0 0 / 10%);
}

.breadcrumbs {
	text-transform: uppercase;
	font-size: 10px;
	letter-spacing: 1px;
	color: #939393;
	margin-bottom: 5px;
	padding-left: 3px;
}

h1 {
	font-size: 20px;
	font-family: Poppins, system-ui, sans-serif;
	font-weight: normal;
	white-space: nowrap;
	overflow-x: hidden;
	text-overflow: ellipsis;
	color: #c5c5c5;
	display: inline-block;
	max-width: 100%;
}

h1 a,
th a {
	color: #000;
}

h1 a {
	padding: 0 3px;
	margin: 0 1px;
}

h1 a:hover {
	background: #ffffc4;
}

h1 a:first-child {
	margin: 0;
}

header,
main {
	background-color: white;
}

main {
	margin: 3em auto;
	border-radius: 5px;
	box-shadow: 0 2px 5px 1px rgb(0 0 0 / 5%);
}

.meta {
	display: flex;
	gap: 1em;
	font-size: 14px;
	border-bottom: 1px solid #e5e9ea;
	padding-top: 1em;
	padding-bottom: 1em;
}

#summary {
	display: flex;
	gap: 1em;
	align-items: center;
	margin-right: auto;
}

.filter-container {
	position: relative;
	display: inline-block;
	margin-left: 1em;
}

#search-icon {
	color: #777;
	position: absolute;
	height: 1em;
	top: .6em;
	left: .5em;
}

#filter {
	padding: .5em 1em .5em 2.5em;
	border: none;
	border: 1px solid #CCC;
	border-radius: 5px;
	font-family: inherit;
	position: relative;
	z-index: 2;
	background: none;
}

.layout,
.layout svg {
	color: #9a9a9a;
}

table {
	width: 100%;
	border-collapse: collapse;
}

tbody tr,
tbody tr a,
.entry a {
	transition: all .15s;
}

tbody tr:hover,
.grid .entry a:hover {
	background-color: #f4f9fd;
}

th,
td {
	text-align: left;
}

th {
	position: sticky;
	top: 0;
	background: white;
	white-space: nowrap;
	z-index: 2;
	text-transform: uppercase;
	font-size: 14px;
	letter-spacing: 1px;
	padding: .75em 0;
}

th.offset {
	top: 24px;
}

td {
	white-space: nowrap;
}

td:nth-child(2) {
	width: 75%;
}

td:nth-child(2) a {
	padding: 1em 0;
	display: block;
}

td:nth-child(3),
th:nth-child(3) {
	padding: 0 20px 0 20px;
	min-width: 150px;
}

td .go-up {
	text-transform: uppercase;
	font-size: 12px;
	font-weight: bold;
}

.name,
.go-up {
	word-break: break-all;
	overflow-wrap: break-word;
	white-space: pre-wrap;
}

.listing .icon-tabler {
	color: #454545;
}

.listing .icon-tabler-folder-filled {
	color: #ffb900 !important;
}

.sizebar {
	position: relative;
	padding: 0.25rem 0.5rem;
	display: flex;
}

.sizebar-bar {
	background-color: #dbeeff;
	position: absolute;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
	z-index: 0;
	height: 100%;
	pointer-events: none;
}

.sizebar-text {
	position: relative;
	z-index: 1;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.grid {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(16em, 1fr));
	gap: 2px;
}

.grid .entry {
	position: relative;
	width: 100%;
}

.grid .entry a {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	padding: 1.5em;
	height: 100%;
}

.grid .entry svg {
	width: 75px;
	height: 75px;
}

.grid .entry img {
	max-height: 200px;
	object-fit: cover;
}

.grid .entry .name {
	margin-top: 1em;
}

footer {
	padding: 40px 20px;
	font-size: 12px;
	text-align: center;
}

.caddy-logo {
	display: inline-block;
	height: 2.5em;
	margin: 0 auto;
}

.overlay {
	position: fixed;
	top: 0;
	bottom: 0;
	left: 0;
	right: 0;
	background: rgba(0, 0, 0, 0.7);
	transition: opacity 500ms;
	z-index: 42;
	display: none;
}

.popup,
#popup1 .popup {
	margin: 3em auto;
	padding: 20px;
	border-radius: 5px;
	width: 90%;
	height: 90%;
	position: relative;
	transition: all 1s ease-in-out;
}

#popup1 .popup {
	background: #fff;
}

#popup1.darkForced .popup {
	background: #000;
}

.popup h2 {
	margin-top: 0;
	color: #a19f9f;
	font-family: sans-serif;
	font-size: small;
	text-align: center;
}

.popup .max {
	position: absolute;
	top: 10px;
	right: 40px;
	transition: all 200ms;
	font-weight: bold;
	text-decoration: none;
	z-index: 1000;
}
.popup .max:hover, .popup .close:hover {
	color: #06D85F;
}

.popup .close {
	position: absolute;
	top: 10px;
	right: 10px;
	transition: all 200ms;
	font-weight: bold;
	text-decoration: none;
	z-index: 1000;
}

#popup1 .content>img {
	max-width: 100%;
	max-height: 90%;
	margin: auto;
	display: block;
	margin: auto;
	top:0;
	bottom:0;
	left:0;
	right:0;
	position:absolute;
}

#popup1 .popup .close, 
#popup1 .popup .max {
	color: #333;
}


.popup .content {
	height: 100%;
	overflow: auto;
}


#popup1 .popup {
	background-color: white;
}

video {
	max-width: 100%;
	max-height: 100%;
	width: 100%;
	margin: auto;
	position: absolute;
	left: 0;
	top: 0;
	right: 0;
	bottom: 0;
}

video::cue {
	color: #ffffff;
	border: 3px solid black;
	text-align: center;
	text-shadow: -1px -1px 1px rgba(255,255,255,.1), 1px 1px 1px rgba(0,0,0,.5), 2px 2px 3px rgba(206,89,55,0);
	font-size: 1.5vw;
}

.fixedplayer {
	display: none;
	text-align: center;
	background: #f1f3f4;
	position: fixed;
	min-width: 67vw;
	width: 100%;
	height: 24px;
	padding: 0;
	top: 0;
	right: 0;
	left:0;
	z-index: 3;
}

.fixedplayer #aplayer{
	width: 432px;
	height: 24px;
}

.fixedplayer a {
	position: absolute;
	top: 2px;
	transition: all 200ms;
	font-weight: bold;
	text-decoration: none;
	z-index: 1000;
	color: #939393;
}
.fixedplayer a:hover {
	color: #f5c400;
}


/* prevent body scroll when modal is shown */
.modal-open {
	touch-action: none;
	-webkit-overflow-scrolling: none;
	overflow: hidden;
	overscroll-behavior: none;
	overflow-x: hidden;
	overflow-y: scroll !important;
	position: fixed;
}

.maximized {
		width: 100% !important;
		height: 100% !important;
		margin: auto !important;
}

@media (max-width: 600px) {
	.hideable {
		display: none;
	}

	td:nth-child(2) {
		width: auto;
	}

	th:nth-child(3),
	td:nth-child(3) {
		padding-right: 5%;
		text-align: right;
	}

	h1 {
		color: #000;
	}

	h1 a {
		margin: 0;
	}

	#filter {
		max-width: 100px;
	}

	.grid .entry {
		max-width: initial;
	}

	.popup {
		width: 100%;
		height: 100%;
		margin: auto;
	}

	#popup1 .close, #popup1 .max {
	font-size: 25px;
	}
}

@media (prefers-color-scheme: dark) {
	html {
		background: black; /* overscroll */
	}

	body {
		background: linear-gradient(180deg, rgb(34 50 66) 0%, rgb(26 31 38) 100%);
		background-attachment: fixed;
	}

	body,
	a,
	svg,
	.layout.current,
	.layout.current svg,
	.go-up {
		color: #ccc;
	}

	h1 a,
	th a {
		color: white;
	}

	h1 {
		color: white;
	}

	h1 a:hover {
		background: hsl(213deg 100% 73% / 20%);
	}

	header,
	main,
	.grid .entry {
		background-color: #101720;
	}

	tbody tr:hover,
	.grid .entry a:hover {
		background-color: #162030;
		color: #fff;
	}

	th {
		background-color: #18212c;
	}

	td a,
	.listing .icon-tabler {
		color: #abc8e3;
	}

	td a:hover,
	td a:hover .icon-tabler {
		color: white;
	}

	td a:visited {
		color: #cd53cd;
	}

	td a:visited:hover {
		color: #f676f6;
	}

	#search-icon {
		color: #7798c4;
	}

	#filter {
		color: #ffffff;
		border: 1px solid #29435c;
	}

	.meta {
		border-bottom: 1px solid #222e3b;
	}

	.sizebar-bar {
		background-color: #1f3549;
	}

	.grid .entry a {
		background-color: #080b0f;
	}

	#Wordmark path,
	#R path {
		fill: #ccc !important;
	}
	#R circle {
		stroke: #ccc !important;
	}
	.fixedplayer {
		background-color: #333;
	}

	#popup1 .popup {
		background: #000;
	}
	#popup1 .popup .close, 
	#popup1 .popup .max {
		color: #e1e0e0;
	}
}

/* README card styles */
#readme-content {
	overflow-wrap: break-word;
	word-wrap: break-word;
}

#readme-content h1,
#readme-content h2,
#readme-content h3,
#readme-content h4,
#readme-content h5,
#readme-content h6 {
	margin-top: 1.5em;
	margin-bottom: 0.5em;
	font-weight: 600;
	line-height: 1.25;
}

#readme-content h1 {
	font-size: 2em;
	border-bottom: 1px solid #e5e9ea;
	padding-bottom: 0.3em;
}

#readme-content h2 {
	font-size: 1.5em;
	border-bottom: 1px solid #e5e9ea;
	padding-bottom: 0.3em;
}

#readme-content h3 {
	font-size: 1.25em;
}

#readme-content h4 {
	font-size: 1em;
}

#readme-content h5 {
	font-size: 0.875em;
}

#readme-content h6 {
	font-size: 0.85em;
	color: #6a737d;
}

#readme-content p {
	margin-top: 0;
	margin-bottom: 1em;
}

#readme-content ul,
#readme-content ol {
	padding-left: 2em;
	margin-top: 0;
	margin-bottom: 1em;
}

#readme-content li {
	margin-bottom: 0.25em;
}

#readme-content code {
	background-color: rgba(27, 31, 35, 0.05);
	border-radius: 3px;
	font-size: 85%;
	margin: 0;
	padding: 0.2em 0.4em;
	font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
}

#readme-content pre {
	background-color: #f6f8fa;
	border-radius: 6px;
	font-size: 85%;
	line-height: 1.45;
	overflow: auto;
	padding: 16px;
	margin-bottom: 1em;
}

#readme-content pre code {
	background-color: transparent;
	border: 0;
	display: inline;
	line-height: inherit;
	margin: 0;
	overflow: visible;
	padding: 0;
	word-wrap: normal;
}

#readme-content blockquote {
	border-left: 4px solid #dfe2e5;
	color: #6a737d;
	padding: 0 1em;
	margin: 0 0 1em 0;
}

#readme-content table {
	border-collapse: collapse;
	border-spacing: 0;
	margin-bottom: 1em;
}

#readme-content table th,
#readme-content table td {
	border: 1px solid #dfe2e5;
	padding: 6px 13px;
}

#readme-content table th {
	font-weight: 600;
	background-color: #f6f8fa;
}

#readme-content table tr {
	background-color: transparent;
	border-top: 1px solid #c6cbd1;
}

#readme-content table tr:nth-child(2n) {
	background-color: #f6f8fa;
}

#readme-content img {
	max-width: 100%;
	box-sizing: content-box;
}

#readme-content a {
	color: #0366d6;
	text-decoration: none;
}

#readme-content a:hover {
	text-decoration: underline;
}

#readme-content hr {
	height: 0.25em;
	padding: 0;
	margin: 24px 0;
	background-color: #e1e4e8;
	border: 0;
}

@media (prefers-color-scheme: dark) {
	#readme-content h1,
	#readme-content h2 {
		border-bottom-color: #222e3b;
	}

	#readme-content h6 {
		color: #8b949e;
	}

	#readme-content code {
		background-color: rgba(110, 118, 129, 0.4);
	}

	#readme-content pre {
		background-color: #161b22;
	}

	#readme-content blockquote {
		border-left-color: #3b4854;
		color: #8b949e;
	}

	#readme-content table th,
	#readme-content table td {
		border-color: #3b4854;
	}

	#readme-content table th {
		background-color: #161b22;
	}

	#readme-content table tr {
		border-top-color: #21262d;
	}

	#readme-content table tr:nth-child(2n) {
		background-color: #0d1117;
	}

	#readme-content a {
		color: #58a6ff;
	}

	#readme-content hr {
		background-color: #21262d;
	}
}

</style>
{{- if eq .Layout "grid"}}
<style>.wrapper { max-width: none; } main { margin-top: 1px; }</style>
{{- end}}

<script>
const REGEX_TYPE_AUDIO = /\.(mp3|m4a|aac|flac|ape|wav|ogg|oga|weba)$/i;
const REGEX_TYPE_VIDEO = /\.(mp4|m4v|avi|mov|mpg|mpeg|ogv|ogm|opus|mkv|webm)$/i;
const REGEX_TYPE_IMAGE = /\.(gif|jpe?g|a?png|tiff?|bmp|webp|ico|wmf|avif|svg)$/i;
const REGEX_TYPE_CODE = /\.(asp|txt|memo|kt|go|ics|rst?|rb|dart|php|js|tsx?|py|cue|ipynb|z?sh|xml|plist|bat|css|json|java|c|cpp|h|m|hpp|conf|ini|pl|yaml|yml|groovy|swift|properties|gradle|srt|sql|lua|m3u8|log?)$/i;
const REGEX_TYPE_MARKDOWN = /\.(md)$/i;
const REGEX_TYPE_CAN_PREVIEW = /\.(mp4|m4v|avi|mov|mpg|mpeg|ogv|ogm|opus|mkv|md|html?|gif|jpe?g|a?png|tiff?|bmp|webp|ico|wmf|avif|svg|asp|txt|memo|kt|go|ics|rst?|rb|dart|php|js|tsx?|py|cue|ipynb|z?sh|xml|plist|bat|css|json|java|c|cpp|h|m|hpp|conf|ini|pl|yaml|yml|groovy|swift|properties|gradle|srt|sql|lua|m3u8?)$/i;

function findNextPrevLink(link, regex, isBackwards) {
	if (!link) {
		return;
	}
	let item = findClosest(link, 'TR', 'file') || findClosest(link, 'DIV', 'entry');

	while(item = isBackwards ? item.previousElementSibling : item.nextElementSibling) {
		const a = item.querySelector('a');

		if (a && regex.test(a.getAttribute('href'))) {
			return a;
		}
	}
}

// keyboard navigation
document.onkeydown = function (e) {
	const v = document.querySelector('.popup video');
	const img = document.querySelector('.popup img');

	switch (e.which) {
		case 27:	// = Escape
			hideModal();
			break;
		case 37: // left
			if (v){
				if (!v.paused) {
					v.pause();
					v.currentTime = v.currentTime - 5.0;
					if (v.paused) {
						v.play();
					}
				}
			} else if (window.currentLink && (img || !v || (v && v.paused && v.currentTime == 0))) {
				const prev = findNextPrevLink(window.currentLink, REGEX_TYPE_CAN_PREVIEW, true);
				if (prev) {
					onLinkClicked(prev);
				}
			}
			break;
		case 32: // Space
			if(e.which == 32){
			// stops default behaviour of space bar. Stop page scrolling down
				e.preventDefault();
				if (v.paused) {
					v.play();
				} else {
					v.pause();
				}
			}
			break;
		case 39: // Right
			if (v && e.which != 32){
				if (!v.paused) {
					v.pause();
					v.currentTime = v.currentTime + 5.0;
					if (v.paused) {
						v.play();
					}
				}
			}
			if (window.currentLink && (img || !v || (v && v.ended)) ) {
				const next = findNextPrevLink(window.currentLink, REGEX_TYPE_CAN_PREVIEW);
				if (next) {
					onLinkClicked(next);
				}
			}

			break;
		case 70: // f-key
			if (!(e.shiftKey || e.ctrlKey || e.altKey || e.metaKey)) {
				if (!window.isFs) {
					window.isFs = true;
					fullscreenOn(v || img || document);
				} else {
					window.isFs = false;
					fullscreenOff(v || img || document);
				}
			}
			break;
	}
};

function fullscreenOn(p) {
	var fs = p.requestFullscreen || p.webkitRequestFullscreen || p.mozRequestFullScreen || p.oRequestFullscreen || p.msRequestFullscreen;
	fs.call(p);
}

function fullscreenOff(p) {
	var fsx = p.exitFullScreen || p.webkitExitFullScreen || p.mozExitFullScreen || p.oExitFullScreen || p.msExitFullScreen;
	fsx.call(p);
}

async function loadSubtitle(subUrl) {
		const url = new URL(subUrl);
		let src;
		if (url.pathname.toLowerCase().endsWith(".srt")) {
		try {
			const resp = await fetch(subUrl);
			if (!resp.ok) {
			throw new Error(`Failed to fetch subtitle from ${subUrl}!`);
			}
			const vtt = srtToVttBlob(await resp.text());
			src = URL.createObjectURL(vtt);
		} catch (error) {
			console.error(error);
		}
		} else {
		src = subUrl;
		}

		return src;
}

function srtToVttBlob(srtData) {
	const VTT_HEAD = `WEBVTT

STYLE
::cue {font-size: 3vw; color:#ffffff; border:3px solid black; text-align:center;text-shadow: -1px -1px 1px rgba(255,255,255,.1), 1px 1px 1px rgba(0,0,0,.5), 2px 2px 3px rgba(206,89,55,0)}
::cue(b) {color: rgb(51, 216, 18); border: 2px solid black;}
::cue(i) {color: #00bafd;}
::cue(u) {color: #ff00ee;}
`;
	// Replace line breaks with \n
	let subtitles = srtData.replace(/\r\n|\r|\n/g, "\n");
	// commas -> dots in timestamps
	subtitles = subtitles.replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g, "$1.$2");
	// map SRT font colors to VTT cue span classes
	var colorMap = {};

	// font tags -> ::cue span tags
	subtitles = subtitles.replace(
	/<font color="([^"]+)">([\s\S]*?)<\/font>/g,
	function (_match, color, text) {
		let key =
		"c_" + color.replace(/^rgb/, "").replace(/\W/g, "").toLowerCase();
		colorMap[key] = color;
		return `<c.${key}>${text.replace("\n", "").trim()}</c>`;
	}
	);
	subtitles = subtitles.replace(/<br\s*\/?>/g, "\n");

	let vttSubtitles = VTT_HEAD;

	if (Object.keys(colorMap).length) {
	let vttStyles = "";

	for (let cssClass in colorMap) {
		let color = colorMap[cssClass];
		// add cue style declaration
		vttStyles += `::cue(.${cssClass}) {color: ${color};}\n`;
	}
	vttSubtitles += vttStyles;
	}
	vttSubtitles += "\n"; // an empty line MUST separate styles from subs
	vttSubtitles += subtitles;

	return new Blob([vttSubtitles], { type: "text/vtt" });
}

function findClosest(el, tagName, className) {
	if (el.tagName === tagName && !className || el.classList.contains(className)) {
		return el;
	} else if (el.parentElement) {
		return findClosest(el.parentElement, tagName, className);
	}
	return null;
}

function onDocumentClickHandler(e) {
	const el = e.target;

	let link = el;

	if (link.tagName !== 'A') {
		link = findClosest(link, 'A');
	}

	if (link && (link.matches(".file a, .entry a, h1 a"))) {
		onLinkClicked(link, e);
	} else if (!link && !document.querySelector('#popup1 .popup').contains(el)) {
		hideModal();
	}
}

function escapeRegex(string) {
	return string.replace(/[/\-\\^$*+?.()|[\]{}]/g, '\\$&');
}

function showModal (popup, isForcedDark) {
	window.lastScrollOffset = window.pageYOffset;
	document.body.classList.add('modal-open');
	document.body.style.top = `-${window.lastScrollOffsetllY}px`;
	popup = popup || document.querySelector('#popup1');
	if (isForcedDark) {
		popup.classList.add('darkForced');
	} else {
		popup.classList.remove('darkForced');
	}
	popup.style.display = 'block';
}

function hideModal (popup) {
	popup = popup || document.querySelector('#popup1');

	if (popup.style.display !== 'none') {
		popup.style.display = 'none';
		popup.querySelector('.content').innerHTML = '';

		document.body.classList.remove('modal-open');

		if (window.lastScrollOffset){
			window.scrollTo(0, window.lastScrollOffset);
		}
	}
}
function toggleRestoreModal (popup) {
	var popup = popup || document.querySelector('#popup1');
	if (popup.style.display !== 'none') {
		popup.querySelector('.popup').classList.toggle('maximized');
	}
}

function onAudioEnded(el) {
	if (el && window.currentLink) {
		window.currentLink.classList.remove('nowPlaying');
		let nextLink= findNextPrevLink(window.currentLink, REGEX_TYPE_AUDIO);
		const href = nextLink.getAttribute('href');

		if (REGEX_TYPE_AUDIO.test(href)) {
			el.src = href;
			el.play();
			el.title = decodeURIComponent(href);
			nextLink.classList.add('nowPlaying');
			nextLink.scrollIntoView(
				{
					behavior: "smooth",
					block: "center"
				}
				);
			window.currentLink = nextLink;
		}
	}
}

function startAudioPlayer(href) {
	const audioPlayer = document.getElementById('aplayer');
		audioPlayer.parentElement.style.display = 'block';
		audioPlayer.src = href;
		audioPlayer.title = decodeURIComponent(href);
		audioPlayer.play();
		document.querySelectorAll('th').forEach((th) => th.classList.toggle('offset'));
}

function hideAudioPlayer() {
	const audioPlayer = document.getElementById('aplayer');
	audioPlayer.pause();
	audioPlayer.parentElement.style.display = 'none';
	document.querySelectorAll('th').forEach((th) => th.classList.toggle('offset'));

	if (window.currentLink) {
		window.currentLink.classList.remove('nowPlaying');
	}
}

function onLinkClicked(link, evt) {
	var href = link.getAttribute("href");

	if (window.currentLink && REGEX_TYPE_AUDIO.test(href)) {
		window.currentLink.classList.remove('nowPlaying');
	}
	window.currentLink = link;

	const event = evt || new Event('click');

	const fileName = href.split('/').pop();
	const baseName = fileName.split('.')[0];

	var popup = document.querySelector('#popup1');
	var content = popup.querySelector('.content');
	popup.querySelector('.info').textContent = decodeURIComponent(fileName);

	if (REGEX_TYPE_VIDEO.test(href)) {
		event.preventDefault();
		event.stopImmediatePropagation();

		hideAudioPlayer();

		const video = document.createElement('video');
		video.setAttribute('autoplay', true);
		video.setAttribute('controls', 'controls');
		video.setAttribute('preload', 'auto');
		video.setAttribute('tabIndex', "-1");

		const source = document.createElement('source');

		source.src = href;
		video.appendChild(source);

		document.querySelectorAll('a').forEach((link) => {
			if (new RegExp(`${baseName}\.?.*\.(vtt|srt)`, 'i').test(link.href)) {
				const track = document.createElement('track');
				loadSubtitle(link.href)
					.then(url => {
						track.src = url;
						track.kind = 'subtitles';
						track.label = decodeURIComponent(link.href.split('/').pop());
						track.srclang = 'en';

						if (!video.hasDefaultSubs) {
							track.default = true;
							video.hasDefaultSubs = true;
						}

						video.appendChild(track);
					})
			}
		});

		content.innerHTML = '';
		content.appendChild(video);
		showModal(popup, true);

	}else if (REGEX_TYPE_AUDIO.test(href)) {
		event.preventDefault();
		event.stopImmediatePropagation();

		startAudioPlayer(href);
		link.classList.add('nowPlaying');
	}
	// special treatment by extension
	else if (REGEX_TYPE_MARKDOWN.test(href) || REGEX_TYPE_CODE.test(href)) {
		event.preventDefault();
		event.stopImmediatePropagation();
		fetch(href)
			.then(function (response) {
				if (response.ok) {
					return response.text();
				} else {
					throw new Error(response.statusText);
				}
			})
			.then(function (text) {
				showModal(popup);
				var content = popup.querySelector('.content');
				// Check if the window has marked library
				if (href.match(REGEX_TYPE_MARKDOWN) && window.marked) {
					// Parse the markdown text as HTML and set it as the popup innerHTML
					content.innerHTML = marked.parse(text);
				} else {
					content.innerHTML = `<pre><code>${text}</code></pre>`;
					window.hljs ? window.hljs.highlightAll() : console.error('nohljs!')
				}
			})
			.catch(function (error) {
				console.error(error);
			});
	} else if (REGEX_TYPE_IMAGE.test(href)) {
		event.preventDefault();
		event.stopImmediatePropagation();
		content.innerHTML = `<img src="${href}">`;
		showModal(popup, true);
	} else if (window.location.search && !link.href.includes(window.location.search)) { // regular click
		event.preventDefault();
		event.stopImmediatePropagation();
		document.location.href = `${link.href}${window.location.search}`;
	}

}
document.onclick = onDocumentClickHandler;
</script>

</head>
<body onload="initPage()">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" color="red"><defs><g id="go-up"><path stroke="none" d="M0 0h24v24H0z"/><path d="M18 18h-6a3 3 0 0 1-3-3V5L5 9m8 0L9 5"/></g><g id="folder"><path stroke="none" d="M0 0h24v24H0z"/><path fill="#ffb900" stroke-width="0" d="M9 3a1 1 0 0 1 .6.2h.1L12.4 6H19a3 3 0 0 1 3 2.8V17a3 3 0 0 1-2.8 3H5a3 3 0 0 1-3-2.8V6a3 3 0 0 1 2.8-3H9z"/></g><g id="folder-symlink"><path stroke="none" d="M0 0h24v24H0Z"/><path fill="#ffb900" stroke-width="0" d="M9 3a1 1 0 0 1 .6.2h.1L12.4 6H19a3 3 0 0 1 3 2.8V17a3 3 0 0 1-2.8 3H5a3 3 0 0 1-3-2.8V6a3 3 0 0 1 2.8-3H5Z"/><path fill="#000" stroke-width=".1" d="M2.8 17.3c0-2.4 1.8-4.3 4-4.5v-1.1c0-.4.5-.6.7-.3l2.5 2.5v.2l-2.5 2.5c-.2.2-.6 0-.6-.3v-1c-2 .2-3.5 1.3-3.8 3.2l-.3-1.2Z"/></g><g id="symlink"><path stroke="none" d="M0 0h24v24H0z"/><path d="M4 21v-4a3 3 0 0 1 3-3h5"/><path d="m9 17 3-3-3-3m5-8v4a1 1 0 0 0 1 1h4"/><path d="M5 11V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2H7.5"/></g><g id="generic"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"/></g><g id="license"><path stroke="none" d="M0 0h24v24H0z"/><path d="M15 21H6a3 3 0 0 1-3-3v-1h10v2a2 2 0 0 0 4 0V5a2 2 0 1 1 2 2h-2m2-4H8a3 3 0 0 0-3 3v11M9 7h4m-4 4h4"/></g><g id="image"><path stroke="none" d="M0 0h24v24H0z"/><path d="M15 8h0M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6z"/><path d="m3 16 5-5c1-.9 2-.9 3 0l5 5"/><path d="m14 14 1-1c1-.9 2-.9 3 0l3 3"/></g><g id="video"><path stroke="none" d="M0 0h24v24H0z"/><path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm4-2v16m8-16v16M4 8h4m-4 8h4m-4-4h16m-4-4h4m-4 8h4"/></g><g id="audio"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 17a3 3 0 1 0 6 0 3 3 0 1 0-6 0m10 0a3 3 0 1 0 6 0 3 3 0 1 0-6 0"/><path d="M9 17V4h10v13M9 8h10"/></g><g id="pdf"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v4M5 18h1.5a1.5 1.5 0 0 0 0-3H5v6m12-3h2m1-3h-3v6m-6-6v6h1a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-1z"/></g><g id="csv"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v4M7 16.5a1.5 1.5 0 0 0-3 0v3a1.5 1.5 0 0 0 3 0m3 .8c0 .4.3.7.8.7H12a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h1.3a.8.8 0 0 1 .7.8m3-.8 2 6 2-6"/></g><g id="doc"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2zM9 9h1m-1 4h6m-6 4h6"/></g><g id="sheet"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"/><path d="M8 11h8v7H8zm0 4h8m-5-4v7"/></g><g id="ppt"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9 12V8m6 4v-2m-3 2v-1M3 4h18M4 4v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4m-8 12v4m-3 0h6"/></g><g id="archive"><path stroke="none" d="M0 0h24v24H0z"/><path d="M6 20.7A2 2 0 0 1 5 19V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2h-1"/><path d="M11 17a2 2 0 0 1 2 2v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2zm0-12h-1m3 2h-1m-1 2h-1m3 2h-1m-1 2h-1m3 2h-1"/></g><g id="deb"><path stroke="none" d="M0 0h24v24H0z"/><path d="M12 17c-2.4-1-4-3.2-4-5.6 0-2.2 1-3.2 1.6-3.6C12.2 5.6 16 7.5 16 11c0 2.5-2.9 2.1-3.5 1.5-.6-.6-1-1.5-.5-2.5"/><path d="M3 12a9 9 0 1 0 18 0 9 9 0 1 0-18 0"/></g><g id="dist"><path stroke="none" d="M0 0h24v24H0z"/><path d="m12 3 8 4.5v9L12 21l-8-4.5v-9L12 3m0 9 8-4.5M12 12v9m0-9L4 7.5m12-2.2L8 9.8"/></g><g id="ps1"><path stroke="none" d="M0 0h24v24H0z"/><path d="M4.9 20h11.9a2 2 0 0 0 1.8-1.6l2.4-12A2 2 0 0 0 19.5 4a1.8 1.8 0 0 0-.4 0H7.2a2 2 0 0 0-1.8 1.6L3 17.6A2 2 0 0 0 4.5 20h.4z"/><path d="m9 8 4 4-6 4m5 0h3"/></g><g id="py"><path stroke="none" d="M0 0h24v24H0z"/><path d="M12 9H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h3m4-2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3"/><path d="M8 9V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4m-5-9h0m2 12h0"/></g><g id="sh"><path stroke="none" d="M0 0h24v24H0z"/><path d="M17 20H6a3 3 0 0 1 0-6h11a3 3 0 0 0 0 6h1a3 3 0 0 0 3-3V6a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v8"/></g><g id="dmg"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 5a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1zm4 3v1m10-1v1"/><path d="M12.5 4c-.7 1.5-1.3 3.4-1.5 9h2.5c-.2 2.9 0 5 .5 7"/><path d="M7 15.5c3.7 2 6.3 2 10 0"/></g><g id="iso"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 12a9 9 0 1 0 18 0 9 9 0 1 0-18 0"/><path d="M11 12a1 1 0 1 0 2 0 1 1 0 1 0-2 0m-4 0a5 5 0 0 1 5-5m0 10a5 5 0 0 0 5-5"/></g><g id="md"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M7 15V9l2 2 2-2v6m3-2 2 2 2-2m-2 2V9"/></g><g id="font"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2zm-6-3h2m-1 0v-7"/><path d="M9 12v-1h6v1"/></g><g id="go"><path stroke="none" d="M0 0h24v24H0z"/><path d="M15.7 14.3c1 1 3 .9 4.2-.4 1.3-1.3 1.5-3.1.4-4.2-1-1-3-.9-4.2.4-1.3 1.3-1.5 3.1-.4 4.2zm-3-5.1c-1.1-.5-2.6-.2-3.6.9-1.3 1.3-1.5 3.1-.4 4.2 1 1 3 .9 4.3-.4a3.7 3.7 0 0 0 1-1.9h-2.4m-6.1 3H4m2-6H4m1 3H2"/></g><g id="html"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v4M2 21v-6m3 0v6m-3-3h3m15-3v6h2m-9 0v-6l2 3 2-3v6m-9.5-6h3M9 15v6"/></g><g id="js"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4M3 15h3v4.5a1.5 1.5 0 0 1-3 0m6 .8c0 .4.3.7.8.7H11a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h1.3a.8.8 0 0 1 .7.8"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2h-1"/></g><g id="css"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v4M8 16.5a1.5 1.5 0 0 0-3 0v3a1.5 1.5 0 0 0 3 0m3 .8c0 .4.3.7.8.7H13a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h1.3a.8.8 0 0 1 .7.8m3 4.5c0 .4.3.7.8.7H19a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h1.3a.8.8 0 0 1 .7.8"/></g><g id="json"><path stroke="none" d="M0 0h24v24H0z"/><path d="M20 16V8l3 8V8m-8 0a2 2 0 0 1 2 2v4a2 2 0 1 1-4 0v-4a2 2 0 0 1 2-2zM1 8h3v6.5a1.5 1.5 0 0 1-3 0V14m6 1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H8a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1"/></g><g id="ts"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2h-1"/><path d="M14 3v4a1 1 0 0 0 1 1h4M9 20.3c0 .4.3.7.8.7H11a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h1.3a.8.8 0 0 1 .7.8M3.5 15h3M5 15v6"/></g><g id="sql"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M14 3v4a1 1 0 0 0 1 1h4M5 20.3c0 .4.3.7.8.7H7a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H6a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h1.3a.8.8 0 0 1 .7.8"/><path d="M5 12V5a2 2 0 0 1 2-2h7l5 5v4m-1 3v6h2m-7-6a2 2 0 0 1 2 2v2a2 2 0 1 1-4 0v-2a2 2 0 0 1 2-2zm1 5 1.5 1.5"/></g><g id="db"><path stroke="none" d="M0 0h24v24H0z"/><path d="M4 6a8 3 0 1 0 16 0A8 3 0 1 0 4 6"/><path d="M4 6v6a8 3 0 0 0 16 0V6"/><path d="M4 12v6a8 3 0 0 0 16 0v-6"/></g><g id="email"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/><path d="m3 7 9 6 9-6"/></g><g id="cert"><path stroke="none" d="M0 0h24v24H0z"/><path d="M12 15a3 3 0 1 0 6 0 3 3 0 1 0-6 0"/><path d="M13 17.5V22l2-1.5 2 1.5v-4.5"/><path d="M10 19H5a2 2 0 0 1-2-2V7c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-1 1.7M6 9h12M6 12h3m-3 3h2"/></g><g id="keystore"><path stroke="none" d="M0 0h24v24H0z"/><path d="m16.6 3.8 3.6 3.6a2.9 2.9 0 0 1 0 4.1l-2.7 2.7a2.9 2.9 0 0 1-4 0l-.4-.3-6.5 6.5a2 2 0 0 1-1.3.6H4a1 1 0 0 1-1-.9v-1.3a2 2 0 0 1 .5-1.3h0L4 17h2v-2h2v-2l2.1-2.1-.3-.3a2.9 2.9 0 0 1 0-4.1l2.7-2.7a2.9 2.9 0 0 1 4 0zM15 9h0"/></g></defs></svg>
	<header>
		<div class="fixedplayer">
			<audio controls id="aplayer" src="" onended="onAudioEnded(this)"></audio><a href="#" onclick="hideAudioPlayer(); return false;">&times;</a>
		</div>

		<div class="wrapper">
			<div class="breadcrumbs" style="text-align: justify;">Folder Path</div>
				<h1>
					{{range $i, $crumb := .Breadcrumbs}}<a href="{{html $crumb.Link}}">{{html $crumb.Text}}</a>{{if ne $i 0}}/{{end}}{{end}}
				</h1>
			</div>

		</header>
		<div class="wrapper">
			<main>
				<div class="meta">
					<div id="summary">
						<span class="meta-item">
							<b>{{.NumDirs}}</b> director{{if eq 1 .NumDirs}}y{{else}}ies{{end}}
						</span>
						<span class="meta-item">
							<b>{{.NumFiles}}</b> file{{if ne 1 .NumFiles}}s{{end}}
						</span>
						{{- if ne 0 .Limit}}
						<span class="meta-item">
							(of which only <b>{{.Limit}}</b> are displayed)
						</span>
						{{- end}}
					</div>
					<a href="javascript:queryParam('layout', '')" id="layout-list" class='layout{{if eq $.Layout "list" ""}}current{{end}}'>
						<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layout-list" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
							<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
							<path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path>
							<path d="M4 14m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path>
						</svg>
						List
					</a>
					<a href="javascript:queryParam('layout', 'grid')" id="layout-grid" class='layout{{if eq $.Layout "grid"}}current{{end}}'>
						<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layout-grid" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
							<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
							<path d="M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"></path>
							<path d="M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"></path>
							<path d="M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"></path>
							<path d="M14 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"></path>
						</svg>
						Grid
					</a>
				</div>
				<div class='listing{{if eq .Layout "grid"}} grid{{end}}'>
				{{- if eq .Layout "grid"}}
				{{- range .Items}}
				<div class="entry">
				<a href="{{html .URL}}" title='{{html (.HumanModTime "January 2, 2006 at 15:04:05")}}'>
					{{- if .HasExt ".jpg" ".jpeg" ".png" ".gif" ".webp" ".tiff" ".bmp" ".heif" ".heic" ".svg"}}
					<img loading="lazy" src="{{html .Name}}">
					{{- else}}
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
						<use xlink:href="#{{template "icon" .}}"></use>
					</svg>
					{{- end}}
					<div class="name">{{html .Name}}</div>
					<div class="size">{{.HumanSize}}</div>
				</a>
			</div>
				{{- end}}
				{{- else}}
				<table aria-describedby="summary">
					<thead>
					<tr>
						<th></th>
						<th>
							{{- if and (eq .Sort "namedirfirst") (ne .Order "desc")}}
							<a href="?sort=namedirfirst&order=desc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}" class="icon">
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M18 14l-6 -6l-6 6h12"></path>
								</svg>
							</a>
							{{- else if and (eq .Sort "namedirfirst") (ne .Order "asc")}}
							<a href="?sort=namedirfirst&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}" class="icon">
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M6 10l6 6l6 -6h-12"></path>
								</svg>
							</a>
							{{- else}}
							<a href="?sort=namedirfirst&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}" class="icon sort">
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M18 14l-6 -6l-6 6h12"></path>
								</svg>
							</a>
							{{- end}}

							{{- if and (eq .Sort "name") (ne .Order "desc")}}
							<a href="?sort=name&order=desc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								<span class="hidecol">
									Name
								</span>
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M18 14l-6 -6l-6 6h12"></path>
								</svg>
							</a>
							{{- else if and (eq .Sort "name") (ne .Order "asc")}}
							<a href="?sort=name&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								<span class="hidecol">
									Name
								</span>
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M6 10l6 6l6 -6h-12"></path>
								</svg>
							</a>
							{{- else}}
							<a href="?sort=name&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								<span class="hidecol">
									Name
								</span>
							</a>
							{{- end}}

							<div class="filter-container">
								<svg id="search-icon" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path>
									<path d="M21 21l-6 -6"></path>
								</svg>
								<input type="search" placeholder="Search" id="filter">
							</div>
						</th>
						<th>
							{{- if and (eq .Sort "size") (ne .Order "desc")}}
							<a href="?sort=size&order=desc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								Size
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M18 14l-6 -6l-6 6h12"></path>
								</svg>
							</a>
							{{- else if and (eq .Sort "size") (ne .Order "asc")}}
							<a href="?sort=size&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								Size
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M6 10l6 6l6 -6h-12"></path>
								</svg>
							</a>
							{{- else}}
							<a href="?sort=size&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								Size
							</a>
							{{- end}}
						</th>
						<th class="hideable">
							{{- if and (eq .Sort "time") (ne .Order "desc")}}
							<a href="?sort=time&order=desc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								Modified
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M18 14l-6 -6l-6 6h12"></path>
								</svg>
							</a>
							{{- else if and (eq .Sort "time") (ne .Order "asc")}}
							<a href="?sort=time&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								Modified
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M6 10l6 6l6 -6h-12"></path>
								</svg>
							</a>
							{{- else}}
							<a href="?sort=time&order=asc{{if ne 0 .Limit}}&limit={{.Limit}}{{end}}{{if ne 0 .Offset}}&offset={{.Offset}}{{end}}">
								Modified
							</a>
							{{- end}}
						</th>
						<th class="hideable"></th>
					</tr>
					</thead>
					<tbody>
					{{- if .CanGoUp}}
					<tr>
						<td></td>
						<td>
							<a href="..">
								<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-corner-left-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
									<path d="M18 18h-6a3 3 0 0 1 -3 -3v-10l-4 4m8 0l-4 -4"></path>
								</svg>
								<span class="go-up">Up</span>
							</a>
						</td>
						<td></td>
						<td class="hideable"></td>
						<td class="hideable"></td>
					</tr>
					{{- end}}
					{{- range .Items}}
					<tr class="file">
						<td></td>
						<td>
							<a href="{{html .URL}}">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="#{{template "icon" .}}"></use>
								</svg>
								<span class="name">{{html .Name}}</span>
							</a>
						</td>
						{{- if .IsDir}}
						<td>&mdash;</td>
						{{- else}}
						<td class="size" data-size="{{.Size}}">
							<div class="sizebar">
								<div class="sizebar-bar"></div>
								<div class="sizebar-text">
									{{.HumanSize}}
								</div>
							</div>
						</td>
						{{- end}}
						<td class="timestamp hideable">
							<time datetime="{{.HumanModTime "2006-01-02T15:04:05Z"}}">{{.HumanModTime "01/02/2006 03:04:05 PM -07:00"}}</time>
						</td>
						<td class="hideable"></td>
					</tr>
					{{- end}}
					</tbody>
				</table>
				{{- end}}
			</div>
			</main>

			{{- /* Check if README.md exists in current directory */}}
			{{- $hasReadme := false}}
			{{- range .Items}}
				{{- if and (not .IsDir) (or (eq .Name "README.md") (eq .Name "readme.md") (eq .Name "Readme.md"))}}
					{{- $hasReadme = true}}
				{{- end}}
			{{- end}}

			{{- if $hasReadme}}
			<main style="margin-top: 2em;">
				<div class="meta" style="border-bottom: none;">
					<div style="display: flex; align-items: center; gap: 0.5em;">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
							<use xlink:href="#md"></use>
						</svg>
						<b>README</b>
					</div>
				</div>
				<div id="readme-content" style="padding: 2em 5%; line-height: 1.6;">
					<div style="text-align: center; color: #999;">Loading README.md...</div>
				</div>
			</main>
			{{- end}}
		</div>

		<script>
			const filterEl = document.getElementById('filter');
			filterEl?.focus({ preventScroll: true });

			filterEl?.addEventListener("search", (e) => {
				filter();
			});

			filterEl?.addEventListener("keydown", (e) => {
				console.log(`Key "${e.key}" released [event: keyup]`);
				filter();


				if (e.keyCode == 13 && e.target.value) { // Enter
					e.preventDefault();
					e.stopImmediatePropagation();
					queryParam('filter', e.target.value);
				}
			});

			function initPage() {
				// populate and evaluate filter
				if (!filterEl?.value) {
					const filterParam = new URL(window.location.href).searchParams.get('filter');
					if (filterParam) {
						filterEl.value = filterParam;
					}
				}
				filter();

				// fill in size bars
				let largest = 0;
				document.querySelectorAll('.size').forEach(el => {
					largest = Math.max(largest, Number(el.dataset.size));
				});
				document.querySelectorAll('.size').forEach(el => {
					const size = Number(el.dataset.size);
					const sizebar = el.querySelector('.sizebar-bar');

					if (sizebar) {
						sizebar.style.width = `${size/largest * 100}%`;
					}
				});

				// Load and render README.md if it exists
				const readmeContent = document.getElementById('readme-content');
				if (readmeContent) {
					loadReadme(readmeContent);
				}

			}

			function loadReadme(container) {
				// Try different case variations of README.md
				const readmeVariants = ['README.md', 'readme.md', 'Readme.md'];
				
				function tryLoadReadme(index) {
					if (index >= readmeVariants.length) {
						container.innerHTML = '<div style="text-align: center; color: #999;">README.md not found</div>';
						return;
					}
					
					fetch(readmeVariants[index])
						.then(function(response) {
							if (response.ok) {
								return response.text();
							} else {
								throw new Error('Not found');
							}
						})
						.then(function(text) {
							if (window.marked) {
								// marked.parse has built-in sanitization enabled by default
								container.innerHTML = marked.parse(text);
							} else {
								// Use textContent to prevent XSS when marked.js is unavailable
								const pre = document.createElement('pre');
								pre.textContent = text;
								container.innerHTML = '';
								container.appendChild(pre);
							}
						})
						.catch(function(error) {
							// Try next variant
							tryLoadReadme(index + 1);
						});
				}
				
				tryLoadReadme(0);
			}

			function filter() {
				if (!filterEl) return;
				const q = filterEl.value.trim().toLowerCase();
				document.querySelectorAll('tr.file').forEach(function(el) {
					if (!q) {
						el.style.display = '';
						return;
					}
					const nameEl = el.querySelector('.name');
					const nameVal = nameEl.textContent.trim().toLowerCase();
					if (nameVal.indexOf(q) !== -1) {
						el.style.display = '';
					} else {
						el.style.display = 'none';
					}
				});
			}


			function queryParam(k, v) {
				const qs = new URLSearchParams(window.location.search);
				if (!v) {
					qs.delete(k);
				} else {
					qs.set(k, v);
				}
				const qsStr = qs.toString();
				if (qsStr) {
					window.location.search = qsStr;
				} else {
					window.location = window.location.pathname;
				}
			}

			function localizeDatetime(e, index, ar) {
				if (e.textContent === undefined) {
					return;
				}
				var d = new Date(e.getAttribute('datetime'));
				if (isNaN(d)) {
					d = new Date(e.textContent);
					if (isNaN(d)) {
						return;
					}
				}
				e.textContent = d.toLocaleString();
			}
			var timeList = Array.prototype.slice.call(document.getElementsByTagName("time"));
			timeList.forEach(localizeDatetime);
		</script>
		<div id="popup1" class="overlay">
			<div class="popup">
				<h2 class="info"></h2>
				<a class="max" onclick="toggleRestoreModal()" href="#">&#x26F6;</a>
				<a class="close" onclick="hideModal()" href="#">&times;</a>
				<div class="content">
				</div>
			</div>
		</div>
	</body>
</html>
